#!/bin/sh
# Proper header for a Bash script.

DEPLOY_ADDRESS="/var/www/rivi.senman.cz/app"
DEPLOY_ROOT="/var/www/rivi.senman.cz"

SUDO="sudo"



echo "Start deploy ..."


echo -n "You wanna git pull? ([pull]/copy) "
read answer
if echo "$answer" | grep -iq "^copy" ;then


    ${SUDO} cp -r ./app/views  ${DEPLOY_ADDRESS}
    ${SUDO} cp  -r ./app/controllers  ${DEPLOY_ADDRESS}
    ${SUDO} cp  -r ./app/database  ${DEPLOY_ADDRESS}
    ${SUDO} cp  -r ./app/models  ${DEPLOY_ADDRESS}
    ${SUDO} cp  -r ./app/lang  ${DEPLOY_ADDRESS}

    ${SUDO} cp  ./app/filters.php  ${DEPLOY_ADDRESS}
    ${SUDO} cp  ./app/routes.php  ${DEPLOY_ADDRESS}


else

    cd ${DEPLOY_ROOT} && ${SUDO} git clean -fd && ${SUDO} git pull && cd -
fi




echo -n "You wanna composer self-update? (y/[n]) "
read answer
if echo "$answer" | grep -iq "^y" ;then
    ${SUDO} /usr/local/bin/composer.phar self-update
else
    echo "."
fi



echo -n "You wanna composer update? (y/[n]) "
read answer
if echo "$answer" | grep -iq "^y" ;then
    ${SUDO} composer.phar update -d ${DEPLOY_ROOT}
else
    echo "."
fi


echo -n "You wanna composer dump-autoload? (y/[n]) "
read answer
if echo "$answer" | grep -iq "^y" ;then
    ${SUDO}  composer.phar dump-autoload -d ${DEPLOY_ROOT}
else
    echo "."
fi


echo -n "You wanna artisan dump-autoload? (y/[n]) "
read answer
if echo "$answer" | grep -iq "^y" ;then
    php ${DEPLOY_ROOT}/artisan dump-autoload
else
    echo "."
fi



echo -n "You wanna artisan migrate? ([y]/n) "
read answer
if echo "$answer" | grep -iq "^n" ;then
    echo "no"
else
    php ${DEPLOY_ROOT}/artisan migrate
fi





# chmod -R o+w storage #maybee this ?